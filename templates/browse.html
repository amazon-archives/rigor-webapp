<!DOCTYPE html>
<html lang="en" ng-app="browseApp" ng-controller="BrowseController">
<head>
    <title> Rigor </title>
    <meta name="HandheldFriendly" content="true" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/static/css/vendor/bootstrap.css" />
    <link rel="stylesheet" href="/static/css/vendor/select2-3.2.0.css" />
    <link rel="stylesheet" href="/static/css/rigor.css" />

    <script src="/static/js/vendor/jquery-1.9.1.js"></script>
    <script src="/static/js/vendor/select2-3.2.0.js"></script>

    <!--script src="/static/js/vendor/angular-1.0.6.js" type="text/javascript" charset="utf-8"></script-->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.1.5/angular.min.js" type="text/javascript" charset="utf-8"></script>

    <script src="/static/js/vendor/angular-ui-0.3.2.js"></script>

    <script src="/static/js/browse.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>

<div class="container-fluid">

    <div class="row">
        <div class="span12">

            <h2><a href="" class="black-link" ng-click="ViewChooser.switchView('thumbs')"> Rigor </a></h2>

        </div>
    </div>

    <div ng-switch="ViewChooser.view">
        <!-- SEARCH AND THUMB VIEW -->
        <div ng-switch-when="thumbs">

            <div class="row">

                <!-- SEARCH FORM -->
                <div class="span3">
                    <div class="well well-small">

                        <form ng-submit="SearchAndThumbView.clickSearchButton()" class="no-bottom-margin">
                            <label>database</label>
                            <select class='rigor-sidebar-form-element' ng-model="SearchAndThumbView.query.database_name">
                                <option ng-repeat="dbname in SearchAndThumbView.database_name_choices">(( dbname ))</option>
                            </select>

                            <label>has tags</label>
                            <input
                                type="hidden"
                                class="rigor-sidebar-form-element2"
                                ng-model="SearchAndThumbView.has_tags_select2_user_input"
                                ng-multiple
                                ui-select2="SearchAndThumbView.has_tags_select2_settings"
                            />
                            <!--
                            <input type="text" class="rigor-sidebar-form-element2" ng-model="SearchAndThumbView.has_tags_user_input">
                            -->

                            <div>&nbsp;</div>
                            <div class="btn-group">
                                <button type="submit" class="btn btn-primary"> Search </button>
                                <a href="" ng-click="SearchAndThumbView.clickClearButton()" class="btn">Clear</a>
                            </div>


                            <!-- debug output -->
                            <!--
                            <div>
                                <br> <b> settings: </b> (( SearchAndThumbView.has_tags_select2_settings | json ))
                                <br> <b> user_input: </b> (( SearchAndThumbView.has_tags_select2_user_input | json ))
                            </div>
                            <div>
                                <br> <b>query:</b>
                                <br> <pre>(( SearchAndThumbView.query | json ))</pre>
                                <br>
                                <br> <b>database_name_choices:</b>
                                <br> (( SearchAndThumbView.database_name_choices | json ))
                                <br>
                                <br> <b>tag_choices:</b>
                                <br> (( SearchAndThumbView.tag_choices | json ))
                            </div>
                            -->

                        </form>



                    </div>
                </div>

                <!-- THUMB GRID -->
                <div class="span9" ng-switch="SearchAndThumbView.result_state">

                    <div ng-switch-when="empty">

                    </div>
                    <div ng-switch-when="loading">
                        <b> loading... </b>
                    </div>
                    <div ng-switch-when="loaded">


                        <ul class="pager">
                            <li ng-class="{previous: true,  disabled: !SearchAndThumbView.prevButtonIsEnabled()}">
                                <a href="" ng-click="SearchAndThumbView.clickPrevButton()">&larr; Prev</a>
                            </li>
                            <b> Page (( SearchAndThumbView.query.page+1 )) of (( SearchAndThumbView.result_last_page + 1 )) </b>
                            <li ng-class="{next: true,  disabled: !SearchAndThumbView.nextButtonIsEnabled()}">
                                <a href="" ng-click="SearchAndThumbView.clickNextButton()">Next &rarr;</a>
                            </li>
                        </ul>

                        <ul class="thumbnails">
                            <li class="span3 thumbnail-height-fix" ng-repeat="image in SearchAndThumbView.result_images">
                                <div class="thumbnail">
                                    <!-- fixed-size div to enforce regularity in the thumbnail grid -->
                                    <div style="width:210px; height:200px; text-align:center;">
                                        <a href="" ng-click="SearchAndThumbView.switchToImage(image.id)">
                                            <img ng-src="(( image.thumb_url ))">
                                        </a>
                                    </div>
                                    <p>
                                        <strong>(( image.stamp*1000 | date:'yyyy-MM-dd' ))</strong>
                                        / id (( image.id ))
                                    </p>
                                    <!-- fixed height tag area to enforce regularity in the thumbnail grid -->
                                    <div style="height:80px">
                                        <span ng-repeat="tag in image.tags">
                                            <a href="" ng-click="SearchAndThumbView.clickTag(tag)" class="label label-info">(( tag ))</a>
                                         </span>
                                    </div>
                                </div>
                            </li>
                        </ul>


                    </div>
                    <!-- end ng-switch result_state === loaded -->

                </div>
                <!-- end span9 ng-switch result_state -->

            </div>
            <!-- end row -->

        </div>
        <!-- END SEARCH AND THUMB VIEW -->

        <!-- DETAIL VIEW -->
        <div ng-switch-when="detail">


            <div class="row">
                <!-- sidebar -->
                <div class="span3">

                    <ul class="pager">
                        <li class="previous">
                            <a href="" ng-click="ViewChooser.switchView('thumbs')"><i class="icon-th-large"></i> Thumbs</a>
                        </li>
                    </ul>
                    <!-- pagers -->
                    <div ng-show="SearchAndThumbView.result_state == 'loaded'">
                        <b> Image (( DetailView.image.ii+1 )) of (( SearchAndThumbView.result_full_count )) </b>
                        <ul class="pager">
                            <li ng-class="{previous: true,  disabled: !DetailView.prevButtonIsEnabled()}">
                                <a href="" ng-click="DetailView.clickPrevButton()">&larr; Prev</a>
                            </li>
                            <li ng-class="{next: true,  disabled: !DetailView.nextButtonIsEnabled()}">
                                <a href="" ng-click="DetailView.clickNextButton()">Next &rarr;</a>
                            </li>
                        </ul>
                    </div>

                    <!-- info box -->
                    <div class="well well-small">
                        <p>
                             id: <strong><a href="(( DetailView.image.url ))">(( DetailView.image_id ))</a></strong>
                        <br> db: <strong>(( DetailView.database_name ))</strong>
                        <br> date: <strong>(( DetailView.image.stamp*1000 | date:'yyyy-MM-dd' ))</strong>
                        <br> annotations: <strong>(( DetailView.annotations.length ))</strong>
                        <br> <span ng-repeat="tag in DetailView.image.tags">
                                <a href="" ng-click="clickTag(tag)" class="label label-info">(( tag ))</a>
                             </span>
                        </p>

                        <div>
                            show annotation text:
                            <div class="btn-group">
                                <a href="" ng-click="DetailView.toggleAnnotationText('text:char')"
                                    ng-class="{btn: true, 'btn-mini': true, 'btn-inverse': DetailView.showText['text:char']}">
                                    char
                                </a>
                                <a href="" ng-click="DetailView.toggleAnnotationText('text:word')"
                                    ng-class="{btn: true, 'btn-mini': true, 'btn-inverse': DetailView.showText['text:word']}">
                                    word
                                </a>
                                <a href="" ng-click="DetailView.toggleAnnotationText('text:line')"
                                    ng-class="{btn: true, 'btn-mini': true, 'btn-inverse': DetailView.showText['text:line']}">
                                    line
                                </a>
                            </div>
                        </div>

                        <div>
                            show annotation geom:
                            <div class="btn-group">
                                <a href="" ng-click="DetailView.toggleAnnotationGeom('text:char')"
                                    ng-class="{btn: true, 'btn-mini': true, 'btn-inverse': DetailView.showGeom['text:char']}">
                                    char
                                </a>
                                <a href="" ng-click="DetailView.toggleAnnotationGeom('text:word')"
                                    ng-class="{btn: true, 'btn-mini': true, 'btn-inverse': DetailView.showGeom['text:word']}">
                                    word
                                </a>
                                <a href="" ng-click="DetailView.toggleAnnotationGeom('text:line')"
                                    ng-class="{btn: true, 'btn-mini': true, 'btn-inverse': DetailView.showGeom['text:line']}">
                                    line
                                </a>
                                <a href="" ng-click="DetailView.toggleAnnotationGeom('text:lineorder')"
                                    ng-class="{btn: true, 'btn-mini': true, 'btn-inverse': DetailView.showGeom['text:lineorder']}">
                                    lineorder
                                </a>
                            </div>
                        </div>

                    </div>
                    <!-- end info box -->

                    <!-- selection info box -->
                    <div class="well well-small" ng-show="DetailView.selected_annotation">
                        <p>
                        <b> selected annotation </b>
                        <br> domain: <strong>(( DetailView.selected_annotation.domain ))</strong>
                        <br> date: <strong>(( DetailView.selected_annotation.stamp*1000 | date:'yyyy-MM-dd' ))</strong>
                        <br> id: <strong>(( DetailView.selected_annotation.id ))</strong>
                        <br> confidence: <strong>(( DetailView.selected_annotation.confidence ))</strong>
                        <br> model: <code class="model-text-sidebar">(( DetailView.selected_annotation.model ))</code>
                        </p>
                    </div>
                    <!-- end selection info box -->

                </div>
                <!-- end sidebar -->

                <!-- main image column -->
                <div class="span9">
                    <img class="img-polaroid overlap allow-large-image" ng-src="(( DetailView.image.url ))">
                    <!--canvas
                        class="polaroid-style-padding overlap allow-large-image"
                        id="image_canvas"
                        width="(( DetailView.image.x_resolution ))"
                        height="(( DetailView.image.y_resolution ))"
                    ></canvas-->
                    <svg
                        class="polaroid-style-padding overlap allow-large-image dotted"
                        ng-attr-width="(( DetailView.image.x_resolution ))"
                        ng-attr-height="(( DetailView.image.y_resolution ))"
                        >
                            <!-- TODO: lineorder -->
                            <polygon
                                ng-attr-class="(( 'svg-polygon-line ' + (DetailView.isSelectedAnnotation(annotation) && 'svg-polygon-selected') ))"
                                ng-show="DetailView.showGeom['text:line']"
                                ng-repeat="annotation in DetailView.getAnnotationsByDomain('text:line')"
                                ng-attr-points="(( DetailView.annotationToSvgPoints(annotation) ))"
                                ng-click="DetailView.clickAnnotation(annotation)"
                            />
                            <polygon
                                ng-attr-class="(( 'svg-polygon-word ' + (DetailView.isSelectedAnnotation(annotation) && 'svg-polygon-selected') ))"
                                ng-show="DetailView.showGeom['text:word']"
                                ng-repeat="annotation in DetailView.getAnnotationsByDomain('text:word')"
                                ng-attr-points="(( DetailView.annotationToSvgPoints(annotation) ))"
                                ng-click="DetailView.clickAnnotation(annotation)"
                            />
                            <polygon
                                ng-attr-class="(( 'svg-polygon-char ' + (DetailView.isSelectedAnnotation(annotation) && 'svg-polygon-selected') ))"
                                ng-show="DetailView.showGeom['text:char']"
                                ng-repeat="annotation in DetailView.getAnnotationsByDomain('text:char')"
                                ng-attr-points="(( DetailView.annotationToSvgPoints(annotation) ))"
                                ng-click="DetailView.clickAnnotation(annotation)"
                            />

                            <!--
                            <image
                                xlink:href="http://www.glorioustreats.com/wp-content/uploads/2010/04/Chocolate-cupcakes-1-e1343274163739.jpg"
                                x="20"
                                y="20"
                                height="100px"
                                width="100px"
                                preserveAspectRatio="xMinYMin meet"
                            />
                            -->

                    </svg>
                    <div
                        ng-repeat="annotation in DetailView.getAnnotationsByDomain('text:line')"
                        ng-class="{overlap: true, 'model-text-line': true, 'model-text-selected': DetailView.isSelectedAnnotation(annotation)}"
                        ng-show="DetailView.showText['text:line']"
                        ng-click="DetailView.clickAnnotation(annotation)"
                        style="((
                            'margin-left:' + annotation.boundary[0][0] + 'px; ' +
                            'margin-top:'  + (annotation.boundary[0][1]-40) + 'px; '
                        ))"
                    >
                        (( annotation.model ))
                    </div>
                    <div
                        ng-repeat="annotation in DetailView.getAnnotationsByDomain('text:word')"
                        ng-class="{overlap: true, 'model-text-word': true, 'model-text-selected': DetailView.isSelectedAnnotation(annotation)}"
                        ng-show="DetailView.showText['text:word']"
                        ng-click="DetailView.clickAnnotation(annotation)"
                        style="((
                            'margin-left:' + annotation.boundary[0][0] + 'px; ' +
                            'margin-top:'  + (annotation.boundary[0][1]-20) + 'px; '
                        ))"
                    >
                        (( annotation.model ))
                    </div>
                    <div
                        ng-repeat="annotation in DetailView.getAnnotationsByDomain('text:char')"
                        ng-class="{overlap: true, 'model-text-char': true, 'model-text-selected': DetailView.isSelectedAnnotation(annotation)}"
                        ng-show="DetailView.showText['text:char']"
                        ng-click="DetailView.clickAnnotation(annotation)"
                        style="((
                            'margin-left:' + annotation.boundary[0][0] + 'px; ' +
                            'margin-top:'  + annotation.boundary[0][1] + 'px; '
                        ))"
                    >
                        (( annotation.model ))
                    </div>
                </div>

            </div>


        </div>

    </div>

</div>

</body>
</html>
